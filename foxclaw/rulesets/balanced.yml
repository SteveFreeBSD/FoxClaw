name: balanced
version: 0.7.0
min_firefox_major: 120
rules:
  - id: FC-PREF-001
    title: Require telemetry policy preference to be explicitly set
    severity: INFO
    category: preferences
    check:
      pref_exists:
        key: datareporting.healthreport.uploadEnabled
    rationale: Explicit preference state reduces ambiguity in profile posture reviews.
    recommendation: Set datareporting.healthreport.uploadEnabled explicitly in user.js.
    confidence: medium

  - id: FC-PREF-002
    title: Enforce strict content blocking when preference is set
    severity: MEDIUM
    category: preferences
    check:
      pref_equals:
        key: browser.contentblocking.category
        value: strict
    rationale: Strict tracking protection improves baseline privacy protections.
    recommendation: Set browser.contentblocking.category to "strict" when policy allows.
    confidence: medium

  - id: FC-FILE-001
    title: key4.db must not be group/world accessible
    severity: HIGH
    category: filesystem
    check:
      file_perm_strict:
        key: key4
    rationale: key4.db contains key material metadata and should remain owner-only.
    recommendation: Set permissions to 0600 for key4.db.
    confidence: high

  - id: FC-FILE-002
    title: Cookies SQLite files must be owner-only
    severity: HIGH
    category: filesystem
    check:
      file_perm_strict:
        path_glob: "*cookies.sqlite*"
    rationale: Cookie stores may expose session and tracking artifacts when overly readable.
    recommendation: Restrict cookies SQLite and sidecar files to mode 0600.
    confidence: high

  - id: FC-POLICY-001
    title: Enterprise policy disables telemetry
    severity: INFO
    category: policy
    check:
      policy_key_exists:
        path: policies.DisableTelemetry
    rationale: Managed environments often require explicit telemetry disablement.
    recommendation: Configure DisableTelemetry in policies.json when enterprise policy is used.
    confidence: low

  - id: FC-POLICY-002
    title: Enterprise policy disables Firefox Studies
    severity: INFO
    category: policy
    check:
      policy_key_exists:
        path: policies.DisableFirefoxStudies
    rationale: Disabling studies reduces unmanaged configuration experiments in managed fleets.
    recommendation: Configure DisableFirefoxStudies in policies.json for deterministic posture control.
    confidence: medium

  - id: FC-POLICY-003
    title: Enterprise policy defines ExtensionSettings baseline
    severity: MEDIUM
    category: policy
    check:
      policy_key_exists:
        path: policies.ExtensionSettings
    rationale: Extension policy baselines reduce unmanaged add-on install and permission drift.
    recommendation: Define ExtensionSettings policy controls for allowed/blocked extension behavior.
    confidence: medium

  - id: FC-POLICY-004
    title: Enterprise policy enables HTTPS-only mode governance
    severity: INFO
    category: policy
    check:
      policy_key_exists:
        path: policies.HTTPSOnlyMode
    rationale: HTTPS-only policy controls reduce cleartext navigation exposure in managed environments.
    recommendation: Configure HTTPSOnlyMode in policies.json to align browser transport posture.
    confidence: medium

  - id: FC-SQL-001
    title: places.sqlite integrity quick_check must pass
    severity: HIGH
    category: sqlite
    check:
      sqlite_quickcheck_ok:
        db: places
    rationale: Corrupted history metadata undermines forensic confidence and profile health.
    recommendation: Repair or replace places.sqlite after backup if quick_check fails.
    confidence: high

  - id: FC-SQL-002
    title: cookies.sqlite integrity quick_check must pass
    severity: HIGH
    category: sqlite
    check:
      sqlite_quickcheck_ok:
        db: cookies
    rationale: Cookie store corruption can indicate profile instability or abrupt shutdown issues.
    recommendation: Repair or recreate cookies.sqlite after preserving required artifacts.
    confidence: high

  - id: FC-EXT-001
    title: Active extensions should be signed
    severity: INFO
    category: extensions
    check:
      extension_unsigned_absent:
        include_system: false
    rationale: Unsigned active extensions increase supply-chain and tampering risk.
    recommendation: Disable or remove unsigned extensions and install signed releases.
    confidence: medium

  - id: FC-EXT-002
    title: Active extensions should avoid high-risk permissions
    severity: MEDIUM
    category: extensions
    check:
      extension_permission_risk_absent:
        min_level: high
        include_system: false
    rationale: High-risk extension permissions can materially expand browser attack surface.
    recommendation: Review extension permissions and reduce/remove risky extensions.
    confidence: medium

  - id: FC-EXT-003
    title: Active extensions should not be temporary debug installs
    severity: MEDIUM
    category: extensions
    check:
      extension_debug_absent:
        include_system: false
    rationale: Temporary debug extension installs bypass normal signing/release controls.
    recommendation: Remove temporary installs and use vetted signed extension releases.
    confidence: medium

  - id: FC-EXT-004
    title: Active extensions should not match high-risk extension intel reputation
    severity: MEDIUM
    category: extensions
    check:
      extension_intel_reputation_absent:
        min_level: high
        include_unlisted: true
        include_system: false
    rationale: Extension intelligence snapshots can flag known risky or delisted addons.
    recommendation: Remove or replace extensions flagged with high-risk intel reputation.
    confidence: medium

  - id: FC-CRED-001
    title: Saved logins should not include known vulnerable passwords
    severity: MEDIUM
    category: credentials
    check:
      credential_metric_max:
        metric: vulnerable_passwords_count
        max: 0
    rationale: Firefox leak telemetry indicates credentials that appear in breach datasets.
    recommendation: Rotate vulnerable saved passwords and review account compromise indicators.
    confidence: high

  - id: FC-CRED-002
    title: Saved logins should avoid insecure HTTP origins
    severity: MEDIUM
    category: credentials
    check:
      credential_metric_max:
        metric: insecure_http_login_count
        max: 0
    rationale: Credentials tied to cleartext HTTP origins are at elevated interception risk.
    recommendation: Remove or update saved logins for HTTP-only origins.
    confidence: medium

  - id: FC-CRED-003
    title: Breach alert dismissals should be reviewed
    severity: INFO
    category: credentials
    check:
      credential_metric_max:
        metric: dismissed_breach_alerts_count
        max: 0
    rationale: Dismissed breach alerts can hide unresolved credential exposure.
    recommendation: Review dismissed breach alerts and confirm password rotation occurred.
    confidence: medium
