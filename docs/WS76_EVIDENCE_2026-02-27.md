# WS-76 Evidence (2026-02-27)

WS-76 is research-focused evidence for a vendor-neutral FoxClaw SIEM interface and one open source SIEM ingest proof path.

## Official Documentation Findings

### NDJSON / log shipper portability

- NDJSON spec:
  - each JSON text is newline-delimited and UTF-8
  - media type is `application/x-ndjson`
  - file extension is `.ndjson`
- Elastic Filebeat `filestream`:
  - supports the `ndjson` parser
  - decodes JSON only when there is one JSON object per message

### Wazuh fit as proof target

- Wazuh is documented as "free and open source" and provides "unified XDR and SIEM protection"
- `localfile` supports `log_format` `json` for "single-line JSON files"
- `wazuh-logtest` can verify decoders and matching alerts
- Wazuh records alerts in `/var/ossec/logs/alerts/alerts.json`

## Sample NDJSON

Save as `foxclaw.ndjson`:

```json
{"schema_version":"1.0.0","timestamp":"2026-02-27T15:00:00Z","event_id":"<sha256>","event_type":"foxclaw.finding","host":{"id":"host-01","name":"workstation-01"},"profile":{"profile_id":"profile-abc123","name":"default-release"},"rule_id":"FC-HSTS-001","severity":"HIGH","title":"HSTS downgrade state detected","message":"Profile contains HSTS state inconsistent with expected downgrade-safe posture.","scan_id":"scan-20260227-150000Z","ruleset":"strict"}
{"schema_version":"1.0.0","timestamp":"2026-02-27T15:00:01Z","event_id":"<sha256>","event_type":"foxclaw.scan.summary","host":{"id":"host-01","name":"workstation-01"},"profile":{"profile_id":"profile-abc123","name":"default-release"},"severity":"INFO","title":"FoxClaw scan summary","message":"Scan completed with 2 findings, 0 suppressed, and 0 operational errors.","scan_id":"scan-20260227-150000Z","findings_total":2,"findings_high_count":1,"findings_medium_count":0,"findings_info_count":1,"findings_suppressed_count":0,"ruleset":"strict"}
```

## Wazuh Proof Path

### 1. Put the NDJSON file on a monitored host

```bash
sudo install -d -m 0755 /var/log/foxclaw
sudo install -m 0644 foxclaw.ndjson /var/log/foxclaw/foxclaw.ndjson
```

### 2. Configure Wazuh log collection

Add to `/var/ossec/etc/ossec.conf` on the Wazuh agent or server:

```xml
<localfile>
  <location>/var/log/foxclaw/foxclaw.ndjson</location>
  <log_format>json</log_format>
  <label key="@source">foxclaw</label>
  <label key="observer.vendor">FoxClaw</label>
</localfile>
```

Why this path:

- official `localfile` docs say this section configures collection from files
- official `log_format` docs say `json` is for "single-line JSON files"
- official `label` docs let Wazuh add stable metadata to JSON events

### 3. Add a minimal alerting rule

Add to `/var/ossec/etc/rules/local_rules.xml`:

```xml
<group name="foxclaw,">
  <rule id="100510" level="8">
    <if_sid>86600</if_sid>
    <field name="event_type">^foxclaw.finding$</field>
    <description>FoxClaw finding event</description>
  </rule>

  <rule id="100511" level="3">
    <if_sid>86600</if_sid>
    <field name="event_type">^foxclaw.scan.summary$</field>
    <description>FoxClaw scan summary event</description>
  </rule>
</group>
```

Why this is the simplest proof:

- official Wazuh docs recommend `/var/ossec/etc/rules/local_rules.xml` for smaller custom rule adjustments
- anchored `event_type` matching avoids accidental partial matches
- `if_sid` keeps the example consistent with the proven WS-77 rule chain; if your Wazuh deployment already routes these JSON events directly to local rules, the parent SID may be optional

### 4. Restart Wazuh manager

```bash
sudo systemctl restart wazuh-manager
```

### 5. Validate decoding and rule match with `wazuh-logtest`

```bash
sudo /var/ossec/bin/wazuh-logtest
```

Paste one NDJSON line:

```json
{"schema_version":"1.0.0","timestamp":"2026-02-27T15:00:00Z","event_id":"<sha256>","event_type":"foxclaw.finding","host":{"id":"host-01","name":"workstation-01"},"profile":{"profile_id":"profile-abc123","name":"default-release"},"rule_id":"FC-HSTS-001","severity":"HIGH","title":"HSTS downgrade state detected","message":"Profile contains HSTS state inconsistent with expected downgrade-safe posture.","scan_id":"scan-20260227-150000Z","ruleset":"strict"}
```

Expected proof points:

- Phase 2 shows JSON fields decoded as dynamic fields
- Phase 3 shows local rule `100510`

Official basis:

- Wazuh JSON decoder docs show `Type one log per line`
- Wazuh testing docs say `wazuh-logtest` can verify matching decoders and alerts

### 6. Confirm ingest in `alerts.json`

```bash
sudo tail -f /var/ossec/logs/alerts/alerts.json | jq .
```

Expected signal:

- finding event appears with rule `100510`
- summary event appears with rule `100511`
- the FoxClaw JSON payload is visible in decoded alert data

Official basis:

- Wazuh log collection flow docs say alerts are recorded in `/var/ossec/logs/alerts/alerts.json`

## Optional Tailing Shipper Path

If a deployment already standardizes on Filebeat for tailing:

```yaml
filebeat.inputs:
  - type: filestream
    id: foxclaw-ndjson
    paths:
      - /var/log/foxclaw/foxclaw.ndjson
    parsers:
      - ndjson:
          target: ""
          add_error_key: true
```

Reason:

- official Filebeat docs say the `ndjson` parser decodes JSON line by line
- this keeps FoxClaw output vendor-neutral even if Wazuh is the first proof target

## Research Conclusion

- Best portable FoxClaw SIEM output: NDJSON
- Best first open source proof target: Wazuh
- Simplest proof:
  - write NDJSON
  - collect with `localfile` + `json`
  - validate with `wazuh-logtest`
  - confirm in `alerts.json`

## Sources

- [NDJSON spec](https://github.com/ndjson/ndjson-spec)
- [Elastic Filebeat `filestream` input](https://www.elastic.co/docs/reference/beats/filebeat/filebeat-input-filestream)
- [Wazuh quickstart](https://documentation.wazuh.com/current/quickstart.html)
- [Wazuh `localfile` reference](https://documentation.wazuh.com/current/user-manual/reference/ossec-conf/localfile.html)
- [Wazuh JSON decoder](https://documentation.wazuh.com/current/user-manual/ruleset/decoders/json-decoder.html)
- [Wazuh testing decoders and rules](https://documentation.wazuh.com/current/user-manual/ruleset/testing.html)
- [Wazuh custom rules](https://documentation.wazuh.com/current/user-manual/ruleset/rules/custom.html)
- [Wazuh log collection flow](https://documentation.wazuh.com/current/user-manual/capabilities/log-data-collection/how-it-works.html)
