# WS-81 Evidence (2026-02-28)

WS-81 adds a native Elastic Common Schema output path to the Python baseline so FoxClaw can emit first-class SIEM/XDR events without downstream translation glue.

Schema source of truth used for this slice:

- ECS reference: <https://www.elastic.co/docs/reference/ecs>

## 1. Native CLI Surface

`foxclaw scan --help` now exposes ECS as a first-class output mode alongside JSON, vendor-neutral NDJSON, and SARIF:

```text
--ecs      Emit Elastic Common Schema NDJSON events to stdout.
--ecs-out  Write Elastic Common Schema NDJSON events to this path.
```

`foxclaw acquire windows-share-scan` now also accepts:

```text
--ecs-out  Optional scan ECS NDJSON output path.
```

## 2. Real Deterministic ECS Output

Command used:

```bash
tmpdir="$(mktemp -d)"
.venv/bin/python -m foxclaw scan \
  --profile tests/fixtures/testbed/profile_baseline \
  --ruleset tests/fixtures/testbed/rulesets/integration.yml \
  --ecs-out "${tmpdir}/foxclaw.ecs.ndjson" \
  --deterministic
```

Observed result:

- exit code: `0`
- output file: `${tmpdir}/foxclaw.ecs.ndjson`
- one compact ECS JSON object per line
- finding events emit ECS `event.kind=alert`
- summary event emits ECS `event.kind=event`
- FoxClaw-specific context is preserved under the `foxclaw` extension namespace

Redacted sample finding event:

```json
{"@timestamp":"2025-01-01T00:00:00Z","agent":{"name":"foxclaw","type":"foxclaw","version":"0.1.0"},"ecs":{"version":"9.2.0"},"event":{"action":"foxclaw.finding","category":["configuration","host"],"code":"TB-POL-001","dataset":"foxclaw.scan","id":"<redacted>","kind":"alert","module":"foxclaw","provider":"foxclaw","severity":20,"type":["info"]},"foxclaw":{"event_type":"foxclaw.finding","finding":{"category":"policy","confidence":"low","evidence":["policies.DisableTelemetry: not found (no policies.json discovered)"],"recommendation":"define policies.DisableTelemetry in policies.json","rule_id":"TB-POL-001","severity":"INFO","title":"enterprise telemetry disable policy should exist"},"profile":{"name":"profile_baseline","profile_id":"manual","profile_uid":"<redacted>"},"scan":{"id":"<redacted>"},"schema_version":"1.0.0"},"host":{"architecture":"x86_64","hostname":"<redacted>","id":"<redacted>","name":"<redacted>","os":{"family":"linux","full":"<redacted>","kernel":"<redacted>","name":"Linux","platform":"linux","type":"linux","version":"<redacted>"}},"labels":{"foxclaw_event_type":"foxclaw.finding","foxclaw_profile_id":"manual","foxclaw_profile_uid":"<redacted>","foxclaw_scan_id":"<redacted>","foxclaw_severity":"INFO"},"log":{"level":"info"},"message":"integration tests need deterministic policy evidence","observer":{"name":"FoxClaw","product":"FoxClaw","type":"scanner","vendor":"FoxClaw"},"rule":{"author":["FoxClaw"],"category":"policy","description":"integration tests need deterministic policy evidence","id":"TB-POL-001","name":"enterprise telemetry disable policy should exist","ruleset":"foxclaw"}}
```

Redacted sample summary event:

```json
{"@timestamp":"2025-01-01T00:00:00Z","agent":{"name":"foxclaw","type":"foxclaw","version":"0.1.0"},"ecs":{"version":"9.2.0"},"event":{"action":"foxclaw.scan.summary","category":["host"],"code":"FOXCLAW_SCAN_SUMMARY","dataset":"foxclaw.scan","id":"<redacted>","kind":"event","module":"foxclaw","outcome":"success","provider":"foxclaw","severity":20,"type":["info"]},"foxclaw":{"event_type":"foxclaw.scan.summary","profile":{"name":"profile_baseline","profile_id":"manual","profile_uid":"<redacted>"},"scan":{"id":"<redacted>"},"schema_version":"1.0.0","summary":{"findings_high_count":0,"findings_info_count":4,"findings_medium_count":0,"findings_suppressed_count":0,"findings_total":4}},"host":{"architecture":"x86_64","hostname":"<redacted>","id":"<redacted>","name":"<redacted>","os":{"family":"linux","full":"<redacted>","kernel":"<redacted>","name":"Linux","platform":"linux","type":"linux","version":"<redacted>"}},"labels":{"foxclaw_event_type":"foxclaw.scan.summary","foxclaw_profile_id":"manual","foxclaw_profile_uid":"<redacted>","foxclaw_scan_id":"<redacted>","foxclaw_severity":"INFO"},"log":{"level":"info"},"message":"Scan completed with 4 findings, 0 suppressed, and 0 operational errors.","observer":{"name":"FoxClaw","product":"FoxClaw","type":"scanner","vendor":"FoxClaw"}}
```

## 3. Deterministic Regression Coverage

Focused verification:

```bash
ruff check foxclaw/report/ecs.py foxclaw/cli.py foxclaw/acquire/windows_share.py tests/test_ecs.py tests/test_siem.py
.venv/bin/pytest -q tests/test_ecs.py tests/test_siem.py
```

Observed result:

- `ruff check`: passed
- focused pytest: `14 passed in 0.48s`

Covered cases:

- deterministic ECS rendering for finding and summary events
- ECS stdout and file output from `foxclaw scan`
- stdout mutual exclusion with existing output modes
- ECS file write operational-error path
- share-hosted scan manifest command passthrough
- `acquire windows-share-scan --ecs-out` passthrough
- share-stage manifest artifact recording for ECS outputs

## 4. Full Regression Baseline

Command used:

```bash
.venv/bin/pytest -q
```

Observed result:

```text
298 passed, 7 skipped in 23.52s
```

## 5. Result

WS-81 acceptance points are satisfied:

- ECS output is native to the Python scan path, not a sidecar transform.
- ECS output is available both on stdout and via file output.
- Existing vendor-neutral NDJSON export remains unchanged.
- Share-hosted scan staging and acquisition workflows can emit ECS artifacts.
- Deterministic assertions cover the new renderer and CLI integration path.
