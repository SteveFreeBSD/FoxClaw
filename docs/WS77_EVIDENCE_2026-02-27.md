# WS-77 Evidence (2026-02-27)

WS-77 adds a vendor-neutral NDJSON SIEM export path to the Python baseline and proves file-based ingest with Wazuh.

## 1. Generate NDJSON from a real FoxClaw scan

Command used:

```bash
tmpdir="$(mktemp -d)"
.venv/bin/python -m foxclaw scan \
  --profile tests/fixtures/testbed/profile_baseline \
  --ruleset tests/fixtures/testbed/rulesets/integration.yml \
  --ndjson-out "${tmpdir}/foxclaw.ndjson" \
  --deterministic
```

Observed result:

- exit code: `0`
- output file: `${tmpdir}/foxclaw.ndjson`
- one compact JSON object per line
- finding events include `rule_id`
- summary event omits `rule_id`

Sample NDJSON lines from the successful run below are redacted for host and event identifiers:

```json
{"category":"policy","confidence":"low","event_id":"<redacted>","event_type":"foxclaw.finding","evidence":["policies.DisableTelemetry: not found (no policies.json discovered)"],"host":{"fqdn":"<redacted>","id":"<redacted>","name":"<redacted>"},"message":"integration tests need deterministic policy evidence","profile":{"name":"profile_baseline","profile_id":"manual","profile_uid":"<redacted>"},"rationale":"integration tests need deterministic policy evidence","recommendation":"define policies.DisableTelemetry in policies.json","rule_id":"TB-POL-001","scan_id":"<redacted>","schema_version":"1.0.0","severity":"INFO","timestamp":"2025-01-01T00:00:00Z","title":"enterprise telemetry disable policy should exist"}
{"category":"policy","confidence":"low","event_id":"<redacted>","event_type":"foxclaw.finding","evidence":["policies.DisableFirefoxStudies: not found (no policies.json discovered)"],"host":{"fqdn":"<redacted>","id":"<redacted>","name":"<redacted>"},"message":"integration tests need deterministic policy evidence","profile":{"name":"profile_baseline","profile_id":"manual","profile_uid":"<redacted>"},"rationale":"integration tests need deterministic policy evidence","recommendation":"define policies.DisableFirefoxStudies in policies.json","rule_id":"TB-POL-002","scan_id":"<redacted>","schema_version":"1.0.0","severity":"INFO","timestamp":"2025-01-01T00:00:00Z","title":"enterprise firefox studies disable policy should exist"}
{"event_id":"<redacted>","event_type":"foxclaw.scan.summary","findings_high_count":0,"findings_info_count":4,"findings_medium_count":0,"findings_suppressed_count":0,"findings_total":4,"host":{"fqdn":"<redacted>","id":"<redacted>","name":"<redacted>"},"message":"Scan completed with 4 findings, 0 suppressed, and 0 operational errors.","profile":{"name":"profile_baseline","profile_id":"manual","profile_uid":"<redacted>"},"scan_id":"<redacted>","schema_version":"1.0.0","severity":"INFO","timestamp":"2025-01-01T00:00:00Z","title":"FoxClaw scan summary"}
```

## 2. Wazuh proof-of-ingest

Proof target used:

```bash
docker run -d --name foxclaw-wazuh-ws77 wazuh/wazuh-manager:4.14.3
```

### Wazuh `localfile` configuration

Added to `/var/ossec/etc/ossec.conf`:

```xml
<localfile>
  <location>/var/log/foxclaw/foxclaw.ndjson</location>
  <log_format>json</log_format>
  <label key="@source">foxclaw</label>
  <label key="observer.vendor">FoxClaw</label>
</localfile>
```

### Local rules used

Added to `/var/ossec/etc/rules/local_rules.xml`:

```xml
<group name="foxclaw,">
  <rule id="100510" level="8">
    <if_sid>86600</if_sid>
    <field name="event_type">^foxclaw.finding$</field>
    <description>FoxClaw finding event</description>
  </rule>

  <rule id="100511" level="3">
    <if_sid>86600</if_sid>
    <field name="event_type">^foxclaw.scan.summary$</field>
    <description>FoxClaw scan summary event</description>
  </rule>
</group>
```

Applied and restarted:

```bash
docker cp "${tmpdir}/foxclaw.ndjson" foxclaw-wazuh-ws77:/var/log/foxclaw/foxclaw.ndjson
docker exec foxclaw-wazuh-ws77 /var/ossec/bin/wazuh-control restart
```

## 3. `wazuh-logtest` proof

Command used:

```bash
head -n 1 "${tmpdir}/foxclaw.ndjson" \
  | docker exec -i foxclaw-wazuh-ws77 /var/ossec/bin/wazuh-logtest
```

Observed excerpt:

```text
**Phase 2: Completed decoding.
    name: 'json'
    event_type: 'foxclaw.finding'
    rule_id: 'TB-POL-001'
    schema_version: '1.0.0'

**Phase 3: Completed filtering (rules).
    id: '100510'
    level: '8'
    description: 'FoxClaw finding event'
    groups: '['foxclaw']'
**Alert to be generated.
```

Interpretation:

- Wazuh decoded the FoxClaw NDJSON payload as JSON.
- The local FoxClaw rule matched on `event_type`.
- The event is eligible to produce an alert.

## 4. `alerts.json` proof

After the collector restart, appending the NDJSON file again produced live Wazuh alerts from the monitored file:

```bash
docker exec foxclaw-wazuh-ws77 sh -lc '
  tmp=$(mktemp)
  cp /var/log/foxclaw/foxclaw.ndjson "$tmp"
  cat "$tmp" >> /var/log/foxclaw/foxclaw.ndjson
  rm -f "$tmp"
'
docker exec foxclaw-wazuh-ws77 sh -lc \
  "grep -n '\"event_type\":\"foxclaw.finding\"' /var/ossec/logs/alerts/alerts.json | tail -n 3"
```

Observed excerpt with host and event identifiers redacted:

```json
{"timestamp":"2026-02-27T15:33:50.755+0000","rule":{"level":8,"description":"FoxClaw finding event","id":"100510","firedtimes":2,"mail":false,"groups":["foxclaw"]},"agent":{"id":"000","name":"<redacted-container>"},"manager":{"name":"<redacted-container>"},"id":"<redacted>","full_log":"{\"category\":\"policy\",\"confidence\":\"low\",\"event_id\":\"<redacted>\",\"event_type\":\"foxclaw.finding\",...,\"rule_id\":\"TB-POL-002\",...,\"@source\":\"foxclaw\",\"observer\":{\"vendor\":\"FoxClaw\"}}","decoder":{"name":"json"},"data":{"category":"policy","confidence":"low","event_id":"<redacted>","event_type":"foxclaw.finding","rule_id":"TB-POL-002","schema_version":"1.0.0","severity":"INFO","@source":"foxclaw","observer":{"vendor":"FoxClaw"}},"location":"/var/log/foxclaw/foxclaw.ndjson"}
```

Interpretation:

- Wazuh ingested the FoxClaw NDJSON file via `localfile`.
- The alert carried the FoxClaw-specific rule id `100510`.
- The decoded payload remained machine-readable inside `data`.
- Wazuh labels from `localfile` were preserved (`@source=foxclaw`, `observer.vendor=FoxClaw`).

## 5. Result

WS-77 proof points are satisfied:

- FoxClaw emits vendor-neutral NDJSON.
- Each event is one JSON object per line.
- `foxclaw.finding` events include `rule_id`.
- `foxclaw.scan.summary` omits `rule_id`.
- Wazuh decodes the NDJSON payload and generates FoxClaw-specific alerts from a tailed file.
